<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Futuristic AI Chatbot</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
        :root {
          --primary-accent: #007bff;
          --secondary-accent: #6610f2;
          --dark-bg: #121212;
          --card-bg: #1e1e1e;
          --text-light: #e0e0e0;
          --text-dark: #b0b0b0;
          --border-color: rgba(255, 255, 255, 0.1);
        }

        body {
          font-family: 'Poppins', sans-serif;
          background-color: var(--dark-bg);
          color: var(--text-light);
          display: flex;
          justify-content: center;
          align-items: center;
          height: 100vh;
          margin: 0;
          overflow: hidden;
          position: relative;
        }

        /* Animated background glow */
        body::before {
          content: '';
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: radial-gradient(circle at 15% 50%, var(--primary-accent) 0%, transparent 40%),
                      radial-gradient(circle at 85% 50%, var(--secondary-accent) 0%, transparent 40%);
          animation: glowing 10s ease-in-out infinite;
          z-index: -1;
          opacity: 0.3;
        }

        @keyframes glowing {
          0% { transform: scale(1) translate(0, 0); }
          50% { transform: scale(1.2) translate(10%, 10%); }
          100% { transform: scale(1) translate(0, 0); }
        }

        /* Custom Scrollbar */
        .chat-messages::-webkit-scrollbar { width: 8px; }
        .chat-messages::-webkit-scrollbar-track { background: var(--card-bg); }
        .chat-messages::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.2); border-radius: 10px; }
        .chat-messages::-webkit-scrollbar-thumb:hover { background: rgba(255, 255, 255, 0.4); }

        /* Main Chat Box */
        .chat-container {
          width: 450px; /* Slightly wider */
          height: 90vh;
          max-height: 750px;
          background: var(--card-bg);
          border-radius: 20px;
          box-shadow: 0 12px 24px rgba(0, 0, 0, 0.5);
          display: flex;
          flex-direction: column;
          overflow: hidden;
          border: 1px solid var(--border-color);
          transform: scale(0.98);
          animation: popIn 0.6s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
        }

        @keyframes popIn {
          from { opacity: 0; transform: scale(0.9); }
          to { opacity: 1; transform: scale(1); }
        }

        /* Header */
        .chat-header {
          background: rgba(30, 30, 30, 0.6);
          color: var(--text-light);
          padding: 16px;
          text-align: center;
          font-weight: 600;
          font-size: 1.1em;
          letter-spacing: 0.5px;
          border-bottom: 1px solid var(--border-color);
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 10px;
        }
        .chat-header::before {
            content: '◉';
            color: var(--primary-accent);
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { text-shadow: 0 0 5px var(--primary-accent); }
            50% { text-shadow: 0 0 15px var(--primary-accent), 0 0 20px var(--primary-accent); }
        }

        /* Message Area */
        .chat-messages {
          flex: 1;
          padding: 20px;
          overflow-y: auto;
          background: transparent;
        }

        /* Chat Bubbles */
        .message {
          margin: 10px 0;
          padding: 14px 18px;
          border-radius: 20px;
          max-width: 85%;
          line-height: 1.6;
          word-wrap: break-word;
          opacity: 0;
          animation: messageEnter 0.5s ease-out forwards;
        }
        @keyframes messageEnter {
            from { opacity: 0; transform: translateY(20px) scale(0.9); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .user-message {
          background: linear-gradient(145deg, var(--primary-accent), var(--secondary-accent));
          color: #fff;
          margin-left: auto;
          border-bottom-right-radius: 6px;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .bot-message {
          background: var(--card-bg);
          color: var(--text-light);
          margin-right: auto;
          border-bottom-left-radius: 6px;
          position: relative;
          border: 1px solid var(--border-color);
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
          transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .bot-message:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
        }

        /* Markdown styling */
        .bot-message pre {
          background-color: rgba(0, 0, 0, 0.2);
          border: 1px solid rgba(255, 255, 255, 0.1);
          padding: 10px;
          border-radius: 8px;
          overflow-x: auto;
        }
        .bot-message code { font-family: 'Fira Code', 'Courier New', Courier, monospace; }
        .bot-message pre code { padding: 0; }

        .copy-btn {
          background: rgba(255, 255, 255, 0.1);
          color: var(--text-light);
          border: none;
          border-radius: 6px;
          padding: 6px 10px;
          cursor: pointer;
          font-size: 14px;
          position: absolute;
          top: 8px;
          right: 8px;
          opacity: 0;
          transition: opacity 0.2s ease-in-out, background 0.2s ease;
        }
        .bot-message:hover .copy-btn { opacity: 1; background: rgba(255, 255, 255, 0.15); }
        .copy-btn.copied { opacity: 1; background-color: rgba(0, 255, 0, 0.2); }
        .copy-btn.copied::after {
            content: "Copied!";
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            color: #fff;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            white-space: nowrap;
            animation: fadeOut 1.5s forwards;
        }

        @keyframes fadeOut {
            from { opacity: 1; transform: translateY(0) translateX(-50%); }
            to { opacity: 0; transform: translateY(-10px) translateX(-50%); }
        }

        /* Input Area */
        .chat-input-area {
          display: flex;
          gap: 10px;
          border-top: 1px solid var(--border-color);
          padding: 15px;
          background: transparent;
          flex-shrink: 0;
        }
        .chat-input-area input {
          flex: 1;
          border: 1px solid var(--border-color);
          background: rgba(255, 255, 255, 0.05);
          border-radius: 25px;
          padding: 12px 20px;
          outline: none;
          font-size: 14px;
          color: var(--text-light);
          transition: background 0.3s ease, border-color 0.3s ease;
        }
        .chat-input-area input::placeholder { color: var(--text-dark); }
        .chat-input-area input:focus {
          background: rgba(255, 255, 255, 0.1);
          border-color: var(--primary-accent);
        }

        .chat-input-area button {
          border: none;
          width: 50px;
          height: 50px;
          border-radius: 50%;
          background: var(--primary-accent);
          color: #fff;
          font-size: 1.5em;
          display: flex;
          align-items: center;
          justify-content: center;
          cursor: pointer;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
          transition: background 0.2s ease, transform 0.1s ease, box-shadow 0.2s ease;
        }
        .chat-input-area button:hover {
          background: var(--secondary-accent);
          box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);
        }
        .chat-input-area button:active {
          transform: scale(0.9);
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        /* Typing Indicator */
        .typing {
          display: inline-flex;
          align-items: center;
          gap: 4px;
          color: var(--text-dark);
        }
        .dot {
          width: 8px;
          height: 8px;
          background: var(--text-dark);
          border-radius: 50%;
          display: inline-block;
          animation: wave 1.2s infinite ease-in-out;
        }
        .dot:nth-child(2) { animation-delay: 0.2s; }
        .dot:nth-child(3) { animation-delay: 0.4s; }
        @keyframes wave {
          0%, 40%, 100% { transform: translateY(0); }
          20% { transform: translateY(-5px); }
        }
    </style>
</head>
<body>
<div class="chat-container">
    <div class="chat-header">🤖 Student Support ChatBot</div>
    <div class="chat-messages" id="chat-messages"></div>
    <div class="chat-input-area">
        <input type="text" id="chat-input" placeholder="Type your message..." />
        <button id="send-btn">➤</button>
    </div>
</div>

<script>
    const inputEl = document.getElementById("chat-input");
    const sendBtn = document.getElementById("send-btn");
    const chatEl = document.getElementById("chat-messages");

    sendBtn.addEventListener("click", sendMessage);
    inputEl.addEventListener("keydown", e => {
      if (e.key === "Enter") sendMessage();
    });

    function appendBubble(text, type = "bot") {
      const div = document.createElement("div");
      div.className = `message ${type}-message`;

      if (type === "bot") {
        div.style.position = 'relative';
        const contentDiv = document.createElement("div");
        contentDiv.textContent = text || "";
        div.appendChild(contentDiv);

        const copyButton = document.createElement("button");
        copyButton.className = "copy-btn";
        copyButton.innerHTML = "📋";
        copyButton.onclick = () => {
            navigator.clipboard.writeText(contentDiv.textContent);
            copyButton.classList.add('copied');
            setTimeout(() => copyButton.classList.remove('copied'), 1500);
        };
        div.appendChild(copyButton);
      } else {
        div.textContent = text || "";
      }

      chatEl.appendChild(div);
      chatEl.scrollTop = chatEl.scrollHeight;
      return div;
    }

    function showTypingIndicator() {
      const wrapper = document.createElement("div");
      wrapper.className = "message bot-message";
      const typing = document.createElement("div");
      typing.className = "typing";
      typing.innerHTML = '<span class="dot"></span><span class="dot"></span><span class="dot"></span>';
      wrapper.appendChild(typing);
      chatEl.appendChild(wrapper);
      chatEl.scrollTop = chatEl.scrollHeight;
      return wrapper;
    }

    async function sendMessage() {
      const text = inputEl.value.trim();
      if (!text) return;

      appendBubble(text, "user");
      inputEl.value = "";

      const typingEl = showTypingIndicator();

      try {
        const res = await fetch("/api/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            sessionId: "default-session",
            message: text
          })
        });

        const data = await res.json();
        const botText = (data && data.botMessage) ? data.botMessage : "Sorry, I couldn’t respond.";

        typingEl.remove();
        const botBubble = appendBubble(null, "bot");

        const contentDiv = botBubble.querySelector('div');
        contentDiv.innerHTML = marked.parse(botText);

        contentDiv.querySelectorAll('pre code').forEach((block) => {
          hljs.highlightElement(block);
        });

        const copyButton = botBubble.querySelector('.copy-btn');
        copyButton.onclick = () => {
            navigator.clipboard.writeText(botText);
            copyButton.classList.add('copied');
            setTimeout(() => copyButton.classList.remove('copied'), 1500);
        };

        chatEl.scrollTop = chatEl.scrollHeight;

      } catch (e) {
        typingEl.remove();
        appendBubble("⚠️ Network error. Please try again.", "bot");
      }
    }
</script>
</body>
</html>
